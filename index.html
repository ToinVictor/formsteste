<!doctype html>
<html lang="pt-br">
  <head>
    <meta charset="UTF-8" />
    <title>Pr√©-Teste - Termodin√¢mica</title>

    <style>
      body {
        font-family: Arial;
        margin: 20px;
      }
      .questao {
        margin-bottom: 20px;
        padding: 15px;
        border: 1px solid #ccc;
        border-radius: 8px;
      }
      button {
        padding: 10px 20px;
        font-size: 16px;
        cursor: pointer;
      }
      #resultadoGeral {
        margin-top: 30px;
        padding: 15px;
        background: #f4f4f4;
        border-radius: 8px;
      }
    </style>
  </head>
  <body>
    <h1>PR√â-TESTE - TERMODIN√ÇMICA</h1>

    <form id="formulario">
      <div id="questoes"></div>
      <button type="button" onclick="corrigir()">Enviar e Ver Resultado</button>
    </form>

    <h2 id="resultado"></h2>

    <div id="resultadoGeral">
      <h2>Resultados Gerais da Turma</h2>
      <div id="dadosGerais"></div>
    </div>

    <script type="module">
      // üî• IMPORTA FIREBASE (VERS√ÉO 12.9.0)
      import { initializeApp } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-app.js";
      import {
        getDatabase,
        ref,
        push,
        onValue,
      } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-database.js";

      // üî• SUA CONFIGURA√á√ÉO (J√Å CORRETA)
      const firebaseConfig = {
        apiKey: "AIzaSyCU5KJPxtb99hlzfq6JZVx-wPThWDpYcEQ",
        authDomain: "airtonprojeto-e08ed.firebaseapp.com",
        databaseURL: "https://airtonprojeto-e08ed-default-rtdb.firebaseio.com",
        projectId: "airtonprojeto-e08ed",
        storageBucket: "airtonprojeto-e08ed.firebasestorage.app",
        messagingSenderId: "340143929205",
        appId: "1:340143929205:web:bd6eb2c545605641e1453c",
        measurementId: "G-WVRLMJ5MCY",
      };

      // Inicializa Firebase
      const app = initializeApp(firebaseConfig);
      const database = getDatabase(app);
      const respostasRef = ref(database, "respostas");

      // ---------------- GABARITO ----------------
      const gabarito = {
        1: "C",
        2: "C",
        3: "A",
        4: "D",
        5: "B",
        6: "B",
        7: "A",
        8: "B",
        9: "D",
        10: "C",
        11: "D",
        12: "A",
        13: "A",
        14: "B",
        15: "D",
        16: "C",
      };

      // ---------------- ALTERNATIVAS ----------------
      const alternativas = {
        1: ["A", "B", "C", "D"],
        2: ["A", "B", "C", "D"],
        3: ["A", "B", "C", "D"],
        4: ["A", "B", "C", "D"],
        5: ["A", "B", "C", "D"],
        6: ["A", "B", "C", "D"],
        7: ["A", "B", "C", "D"],
        8: ["A", "B", "C", "D"],
        9: ["A", "B", "C", "D"],
        10: ["A", "B", "C", "D"],
        11: ["A", "B", "C", "D"],
        12: ["A", "B", "C", "D"],
        13: ["A", "B", "C", "D"],
        14: ["A", "B", "C", "D"],
        15: ["A", "B", "C", "D"],
        16: ["A", "B", "C", "D"],
        17: ["A", "B", "C"],
      };

      // ---------------- MONTA QUEST√ïES ----------------
      const container = document.getElementById("questoes");

      for (let i = 1; i <= 17; i++) {
        let div = document.createElement("div");
        div.className = "questao";
        div.innerHTML += "<strong>Quest√£o " + i + "</strong><br><br>";

        alternativas[i].forEach((letra) => {
          div.innerHTML += `
        <label>
        <input type="radio" name="q${i}" value="${letra}">
        ${letra}
        </label><br>`;
        });

        container.appendChild(div);
      }

      // ---------------- CORRIGIR E ENVIAR ----------------
      window.corrigir = function () {
        let acertos = 0;
        let respostasAluno = {};

        for (let i = 1; i <= 17; i++) {
          let resposta = document.querySelector(`input[name="q${i}"]:checked`);
          if (resposta) {
            respostasAluno["q" + i] = resposta.value;
            if (i <= 16 && resposta.value === gabarito[i]) {
              acertos++;
            }
          }
        }

        document.getElementById("resultado").innerHTML =
          "Voc√™ acertou " + acertos + " de 16 quest√µes.";

        // üî• SALVA NO FIREBASE
        push(respostasRef, respostasAluno);

        document.getElementById("formulario").reset();
      };

      // ---------------- RESULTADOS GERAIS EM TEMPO REAL ----------------
      onValue(respostasRef, (snapshot) => {
        let dados = snapshot.val();
        if (!dados) return;

        let contagem = {};

        for (let i = 1; i <= 17; i++) {
          contagem[i] = {};
          alternativas[i].forEach((l) => {
            contagem[i][l] = 0;
          });
        }

        for (let id in dados) {
          let resp = dados[id];
          for (let q in resp) {
            let numero = q.replace("q", "");
            let letra = resp[q];
            contagem[numero][letra]++;
          }
        }

        let html = "";
        for (let i = 1; i <= 17; i++) {
          html += "<strong>Quest√£o " + i + "</strong><br>";
          for (let letra in contagem[i]) {
            html += letra + ": " + contagem[i][letra] + " respostas<br>";
          }
          html += "<br>";
        }

        document.getElementById("dadosGerais").innerHTML = html;
      });
    </script>
  </body>
</html>
